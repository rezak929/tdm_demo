tags: TDM
stages:
  Get Inputs:
    actors:
      AI_ENVIRONMENT:
        parent: FabricSetRead
        in:
          key:
            const: AI_ENVIRONMENT
            default: false
      SYNTHETIC_ENVIRONMENT:
        parent: FabricSetRead
        in:
          key:
            const: SYNTHETIC_ENVIRONMENT
            default: false
      Get TDM_USING_CATALOG_SEQUENCES:
        parent: FabricSetRead
        in:
          key:
            const: TDM_USING_CATALOG_SEQUENCES
            default: false
      Get TDM_SEQ_REPORT:
        parent: FabricSetRead
        in:
          key:
            const: TDM_SEQ_REPORT
            default: false
      Get TARGET_ENTITY_ID:
        parent: FabricSetRead
        in:
          key:
            const: TARGET_ENTITY_ID
            default: false
      Get ROOT_TABLE_NAME:
        parent: FabricSetRead
        in:
          key:
            const: ROOT_TABLE_NAME
            default: false
      Get ROOT_COLUMN_NAME:
        parent: FabricSetRead
        in:
          key:
            const: ROOT_COLUMN_NAME
            default: false
  Enable Sequence:
    dependsOn: Get Inputs
    actors:
      Enable Sequences At Load?:
        parent: JavaScript
        condition: result
        in:
          script:
            const:
              userCode: |
                var result = false;
                var envCondition = (srcEnv == aiEnv || srcEnv == synthEnv);
                if (envCondition || (replaceSeq === "true" && replaceSeqAtSync === "false") || cloneId > 0) {
                    result = true;
                }
                result;
              script: |-
                var result = false;
                var envCondition = srcEnv == aiEnv || srcEnv == synthEnv;

                if (envCondition || replaceSeq === "true" && replaceSeqAtSync === "false" || cloneId > 0) {
                  result = true;
                }

                result;
          replaceSeq:
            external: replaceSeq
            schema: string
            mandatory: false
          replaceSeqAtSync:
            external: replaceSeqAtSync
            schema: string
            mandatory: false
          cloneId:
            external: cloneId
            schema: integer
            mandatory: false
          srcEnv:
            external: TDM_SOURCE_ENVIRONMENT_NAME
            schema: string
            mandatory: false
          synthEnv:
            link: AI_ENVIRONMENT/result
            schema: string
            mandatory: false
          aiEnv:
            link: SYNTHETIC_ENVIRONMENT/result
            schema: string
            mandatory: false
        out:
          result:
            schema: boolean
      Set enable_sequences to True1:
        parent: FabricSet
        in:
          key:
            const: enable_sequences
            default: false
          value:
            const: 'true'
            default: false
      'true':
        parent: Const
        in:
          value:
            const: true
            schema: boolean
        out:
          value:
            external: result
            schema: boolean
    split: '--------------------'
  Set To False:
    else: true
    dependsOn: Get Inputs
    actors:
      Set enable_sequences to False:
        parent: FabricSet
        in:
          key:
            const: enable_sequences
            default: false
          value:
            const: 'false'
            default: false
      'false':
        parent: Const
        in:
          value:
            const: false
            schema: boolean
        out:
          value:
            external: result
            schema: boolean
  Set Globals For Sequences:
    dependsOn: Enable Sequence
    actors:
      Enable Sequences At Load?1:
        parent: JavaScript
        condition: result
        in:
          script:
            const: |
              var result = false;
              if (usingCatalog === "true" && seqReport === "true") {
                  result = true;
              }
              result;
          usingCatalog:
            link: Get TDM_USING_CATALOG_SEQUENCES/result
            schema: string
            mandatory: false
          seqReport:
            link: Get TDM_SEQ_REPORT/result
            schema: string
            mandatory: false
        out:
          result:
            schema: boolean
      Set Globals For Sequence Report:
        parent: InnerFlow
        in:
          flowName:
            const: SetMaskingGlobals
          TDM_USING_CATALOG_SEQUENCES:
            link: Get TDM_USING_CATALOG_SEQUENCES/result
            schema: string
            mandatory: false
          TDM_SEQ_REPORT:
            link: Get TDM_SEQ_REPORT/result
            schema: string
            mandatory: false
          enable_sequences:
            link: true/value
            schema: string
            mandatory: false
          TDM_TASK_EXE_ID:
            external: TDM_TASK_EXE_ID
            schema: string
            mandatory: false
          TDM_SOURCE_ENVIRONMENT_NAME:
            external: TDM_SOURCE_ENVIRONMENT_NAME
            schema: string
            mandatory: false
          TARGET_ENTITY_ID:
            link: Get TARGET_ENTITY_ID/result
            schema: string
            mandatory: false
          LU_TYPE:
            external: LU_TYPE
            schema: string
            mandatory: false
          ROOT_TABLE_NAME:
            link: Get ROOT_TABLE_NAME/result
            schema: string
            mandatory: false
          ROOT_COLUMN_NAME:
            link: Get ROOT_COLUMN_NAME/result
            schema: string
            mandatory: false
    split: '--------------------'
  'No Sequence Report ':
    else: true
    dependsOn: Enable Sequence
    actors:
      'Disable Sequence Report ':
        parent: InnerFlow
        in:
          flowName:
            const: SetMaskingGlobals
          TDM_USING_CATALOG_SEQUENCES:
            const: 'false'
            schema: string
            mandatory: false
          TDM_SEQ_REPORT:
            schema: string
            mandatory: false
          enable_sequences:
            schema: string
            mandatory: false
          TDM_TASK_EXE_ID:
            schema: string
            mandatory: false
          TDM_SOURCE_ENVIRONMENT_NAME:
            schema: string
            mandatory: false
          TARGET_ENTITY_ID:
            schema: string
            mandatory: false
          LU_TYPE:
            schema: string
            mandatory: false
          ROOT_TABLE_NAME:
            schema: string
            mandatory: false
          ROOT_COLUMN_NAME:
            schema: string
            mandatory: false
    split: '--------------------'
  No Sequence Report:
    dependsOn: Set To False
    actors:
      Disable Sequence Report:
        parent: InnerFlow
        in:
          flowName:
            const: SetMaskingGlobals
          TDM_USING_CATALOG_SEQUENCES:
            const: 'false'
            schema: string
            mandatory: false
          TDM_SEQ_REPORT:
            schema: string
            mandatory: false
          enable_sequences:
            schema: string
            mandatory: false
          TDM_TASK_EXE_ID:
            schema: string
            mandatory: false
          TDM_SOURCE_ENVIRONMENT_NAME:
            schema: string
            mandatory: false
          TARGET_ENTITY_ID:
            schema: string
            mandatory: false
          LU_TYPE:
            schema: string
            mandatory: false
          ROOT_TABLE_NAME:
            schema: string
            mandatory: false
          ROOT_COLUMN_NAME:
            schema: string
            mandatory: false

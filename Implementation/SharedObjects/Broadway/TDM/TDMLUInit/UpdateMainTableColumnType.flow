tags: TDM
stages:
  Get Column Type:
    actors:
      ROOT_COLUMN_TYPE:
        parent: Lowercase
        in:
          string:
            external: root_column_type
  Check If Not Text:
    actors:
      NotText:
        parent: NotEquals
        condition: result
        in:
          b:
            const: text
            schema: string
          a:
            link: ROOT_COLUMN_TYPE/string
  File Path:
    actors:
      Path format:
        parent: StringFormat
        in:
          format:
            const: Tables/FABRIC_TDM_ROOT.k2table.xml
  Get Table XML:
    actors:
      Read Table XML:
        parent: FileRead
        in:
          interface:
            const: null
            external: interface
          path:
            link: Path format/string
  Parse XML:
    actors:
      XmlParser:
        parent: XmlParser
        in:
          stream:
            link: Read Table XML/stream
        out:
          object:
            schema: '#ref'
          info:
            schema: '#ref'
  Override The Type:
    actors:
      JavaScript:
        parent: JavaScript
        in:
          script:
            const:
              userCode: |-
                var objOut = data;
                var cols   = objOut.TableObject._value.Columns._value.Column;
                var i, k, col;
                if (Array.isArray && Array.isArray(cols)) {
                  for (i = 0; i < cols.length; i++) {
                    col = cols[i];
                    if (col && col._attributes && col._attributes.id === "IID") {
                      col._attributes.datatype = type;   // or your variable newType
                      break;
                    }
                  }
                } else if (cols && typeof cols.size === 'function' && typeof cols.get === 'function') {
                  for (i = 0; i < cols.size(); i++) {
                    col = cols.get(i);
                    if (col && col._attributes && col._attributes.id === "IID") {
                      col._attributes.datatype = type;
                      break;
                    }
                  }
                } else if (cols && typeof cols === 'object') {
                  if (cols._attributes && cols._attributes.id) {
                    if (cols._attributes.id === "IID") {
                      cols._attributes.datatype = type;
                    }
                  } else {
                    for (k in cols) {
                      if (!cols.hasOwnProperty(k)) continue;
                      col = cols[k];
                      if (col && col._attributes && col._attributes.id === "IID") {
                        col._attributes.datatype = type;
                        break;
                      }
                    }
                  }
                }
                objOut;
              script: |-
                function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

                var objOut = data;
                var cols = objOut.TableObject._value.Columns._value.Column;
                var i, k, col;

                if (Array.isArray && Array.isArray(cols)) {
                  for (i = 0; i < cols.length; i++) {
                    col = cols[i];

                    if (col && col._attributes && col._attributes.id === "IID") {
                      col._attributes.datatype = type; // or your variable newType

                      break;
                    }
                  }
                } else if (cols && typeof cols.size === 'function' && typeof cols.get === 'function') {
                  for (i = 0; i < cols.size(); i++) {
                    col = cols.get(i);

                    if (col && col._attributes && col._attributes.id === "IID") {
                      col._attributes.datatype = type;
                      break;
                    }
                  }
                } else if (cols && _typeof(cols) === 'object') {
                  if (cols._attributes && cols._attributes.id) {
                    if (cols._attributes.id === "IID") {
                      cols._attributes.datatype = type;
                    }
                  } else {
                    for (k in cols) {
                      if (!cols.hasOwnProperty(k)) continue;
                      col = cols[k];

                      if (col && col._attributes && col._attributes.id === "IID") {
                        col._attributes.datatype = type;
                        break;
                      }
                    }
                  }
                }

                objOut;
          type:
            link: ROOT_COLUMN_TYPE/string
            schema: string
            mandatory: false
          data:
            link: XmlParser/object
            schema: '#ref'
            mandatory: false
        out:
          result:
            schema: '#ref'
  Covert To Stream:
    actors:
      Convert Obj to XML:
        parent: XmlStringify
        in:
          object:
            link: JavaScript/result
  'Write New File ':
    actors:
      Write Table XML to Folder:
        parent: FileWrite
        in:
          interface:
            const: null
            external: interface
          path:
            link: Path format/string
          stream:
            link: Convert Obj to XML/xmlString
schemas:
  XmlParser.out.object:
    type: object
    properties:
      TableObject:
        type: object
        properties:
          _value:
            type: object
            properties:
              Name:
                type: object
                properties:
                  _value:
                    type: string
              ID:
                type: object
                properties:
                  _value:
                    type: string
              EntityId:
                type: object
                properties:
                  _value:
                    type: string
              ColumnsCollation:
                type: object
                properties:
                  _value:
                    type: string
              FullTextSearch:
                type: object
                properties:
                  _value:
                    type: string
              Columns:
                type: object
                properties:
                  _value:
                    type: object
                    properties:
                      Column:
                        type: object
                        properties:
                          _attributes:
                            type: object
                            properties:
                              datatype:
                                type: string
                              id:
                                type: string
                              index:
                                type: string
                              name:
                                type: string
              IndexesList:
                type: object
                properties:
                  _value:
                    type: object
                    properties:
                      Index:
                        type: object
                        properties:
                          _attributes:
                            type: object
                            properties:
                              columnsIdsList:
                                type: string
                              id:
                                type: string
                              instanceOnly:
                                type: string
                              pk:
                                type: string
                              unique:
                                type: string
              EnrichmentList:
                type: object
                properties: {
                  }
              LazyDataUpdate:
                type: object
                properties:
                  _attributes:
                    type: object
                    properties:
                      performEvery:
                        type: string
                      syncMethod:
                        type: string
                  _value:
                    type: object
                    properties:
                      DecisionFunction:
                        type: object
                        properties: {
                          }
              TriggersList:
                type: object
                properties: {
                  }
  XmlParser.out.info:
    type: object
    properties:
      version:
        type: string
      standalone:
        type: boolean
      header:
        type: string
  JavaScript.in.data:
    type: object
    properties:
      TableObject:
        type: object
        properties:
          _value:
            type: object
            properties:
              Name:
                type: object
                properties:
                  _value:
                    type: string
              ID:
                type: object
                properties:
                  _value:
                    type: string
              EntityId:
                type: object
                properties:
                  _value:
                    type: string
              ColumnsCollation:
                type: object
                properties:
                  _value:
                    type: string
              FullTextSearch:
                type: object
                properties:
                  _value:
                    type: string
              Columns:
                type: object
                properties:
                  _value:
                    type: object
                    properties:
                      Column:
                        type: array
                        items:
                          type: object
                          properties:
                            _attributes:
                              type: object
                              properties:
                                datatype:
                                  type: string
                                id:
                                  type: string
                                index:
                                  type: string
                                name:
                                  type: string
              IndexesList:
                type: object
                properties:
                  _value:
                    type: object
                    properties:
                      Index:
                        type: object
                        properties:
                          _attributes:
                            type: object
                            properties:
                              columnsIdsList:
                                type: string
                              id:
                                type: string
                              instanceOnly:
                                type: string
                              pk:
                                type: string
                              unique:
                                type: string
              EnrichmentList:
                type: object
                properties: {
                  }
              LazyDataUpdate:
                type: object
                properties:
                  _attributes:
                    type: object
                    properties:
                      performEvery:
                        type: string
                      syncMethod:
                        type: string
                  _value:
                    type: object
                    properties:
                      DecisionFunction:
                        type: object
                        properties: {
                          }
              TriggersList:
                type: object
                properties: {
                  }
  JavaScript.out.result:
    type: object
    properties:
      TableObject:
        type: object
        properties:
          _value:
            type: object
            properties:
              Name:
                type: object
                properties:
                  _value:
                    type: string
              ID:
                type: object
                properties:
                  _value:
                    type: string
              EntityId:
                type: object
                properties:
                  _value:
                    type: string
              ColumnsCollation:
                type: object
                properties:
                  _value:
                    type: string
              FullTextSearch:
                type: object
                properties:
                  _value:
                    type: string
              Columns:
                type: object
                properties:
                  _value:
                    type: object
                    properties:
                      Column:
                        type: array
                        items:
                          type: object
                          properties:
                            _attributes:
                              type: object
                              properties:
                                name:
                                  type: string
                                id:
                                  type: string
                                index:
                                  type: string
                                datatype:
                                  type: string
              IndexesList:
                type: object
                properties:
                  _value:
                    type: object
                    properties:
                      Index:
                        type: object
                        properties:
                          _attributes:
                            type: object
                            properties:
                              id:
                                type: string
                              pk:
                                type: string
                              unique:
                                type: string
                              instanceOnly:
                                type: string
                              columnsIdsList:
                                type: string
              EnrichmentList:
                type: object
                properties: {
                  }
              LazyDataUpdate:
                type: object
                properties:
                  _attributes:
                    type: object
                    properties:
                      syncMethod:
                        type: string
                      performEvery:
                        type: string
                  _value:
                    type: object
                    properties:
                      DecisionFunction:
                        type: object
                        properties: {
                          }
              TriggersList:
                type: object
                properties: {
                  }
